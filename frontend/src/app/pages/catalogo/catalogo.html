<app-navbar></app-navbar>
<!-- Esta version es la wena -->
<section class="hero">
  <h1>Encuentra la propiedad de tus sue√±os</h1>
  <form class="search-bar" (ngSubmit)="buscar()">
    <div class="operacion-toggle">
      <mat-button-toggle-group
        [(ngModel)]="f.operacion"
        name="operacion"
        aria-label="Tipo de operaci√≥n"
        appearance="legacy"
        (change)="buscar()"
      >
        <mat-button-toggle value="">Todos</mat-button-toggle>
        <mat-button-toggle value="venta">Venta</mat-button-toggle>
        <mat-button-toggle value="alquiler">Alquiler</mat-button-toggle>
      </mat-button-toggle-group>
    </div>

    <!-- üîπ Tipo -->
    <mat-form-field>
      <mat-label>Tipo</mat-label>
      <mat-select [(ngModel)]="f.tipo" name="tipo">
        <mat-option value="">Cualquiera</mat-option>
        <mat-option value="pisos">Pisos, √Åticos y D√∫plex</mat-option>
        <mat-option value="chalets">Chalets y Casas</mat-option>
        <mat-option value="oficina">Oficina</mat-option>
        <mat-option value="local">Local</mat-option>
        <mat-option value="nave">Nave</mat-option>
        <mat-option value="plaza_garaje">Plaza de garaje</mat-option>
        <mat-option value="terreno">Terreno</mat-option>
        <mat-option value="trastero">Trastero</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- üîπ Zona -->
    <mat-form-field>
      <mat-label>Zona</mat-label>
      <input
        matInput
        [(ngModel)]="f.zona"
        name="zona"
        placeholder="Centro, Norte..."
        [matAutocomplete]="autoZona"
        (ngModelChange)="filterZonas($event)"
        (focus)="onZonaFocus()"
      />

      <!-- ‚ùå Bot√≥n dentro del input -->
      <!-- ‚ùå Cruz dentro del input -->
      <button
        *ngIf="f.zona"
        matSuffix
        type="button"
        class="clear-btn"
        (click)="clearZona()"
        aria-label="Borrar zona"
      >
        <mat-icon>close</mat-icon>
      </button>

      <mat-autocomplete
        #autoZona="matAutocomplete"
        (optionSelected)="onZonaSelected($event.option.value)"
      >
        <mat-option *ngFor="let z of filteredZonas" [value]="z">
          {{ z }}
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>

    <div class="actions">
      <button class="botonOtroColor" mat-stroked-button>Buscar</button>
      <button class="botonOtroColor" mat-stroked-button (click)="toggleMoreFilters()">
        {{ moreFiltersLabel }}
      </button>
      <button class="botonOtroColor" mat-stroked-button type="button" (click)="limpiarFiltros()">
        Quitar filtros
      </button>
    </div>

    <div class="more-filters" [class.active]="showMoreFilters">
      <!-- üîπ Precio -->
      <div>
        <h3>Precio</h3>
        <mat-form-field class="field">
          <mat-label>M√≠n</mat-label>
          <mat-select [(ngModel)]="f.precioMin" name="precioMin">
            <mat-option value="">Cualquiera</mat-option>
            <mat-option *ngFor="let p of precios" [value]="p">{{ p | number }} ‚Ç¨</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field class="field">
          <mat-label>M√°x</mat-label>
          <mat-select [(ngModel)]="f.precioMax" name="precioMax">
            <mat-option value="">Cualquiera</mat-option>
            <mat-option *ngFor="let p of precios" [value]="p">{{ p | number }} ‚Ç¨</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- üîπ Habitaciones -->
      <div>
        <h3>Habitaciones</h3>
        <mat-form-field class="field">
          <mat-label>M√≠n</mat-label>
          <mat-select [(ngModel)]="f.dormitoriosMin" name="dormitoriosMin">
            <mat-option value="">Cualquiera</mat-option>
            <mat-option *ngFor="let d of dormitorios" [value]="d">{{ d }}</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field class="field">
          <mat-label>M√°x</mat-label>
          <mat-select [(ngModel)]="f.dormitoriosMax" name="dormitoriosMax">
            <mat-option value="">Cualquiera</mat-option>
            <mat-option *ngFor="let d of dormitorios" [value]="d">{{ d }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- üîπ Ba√±os -->
      <div>
        <h3>Ba√±os</h3>
        <mat-form-field class="field">
          <mat-label>M√≠n</mat-label>
          <mat-select [(ngModel)]="f.banosMin" name="banosMin">
            <mat-option value="">Cualquiera</mat-option>
            <mat-option *ngFor="let b of banos" [value]="b">{{ b }}</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field class="field">
          <mat-label>M√°x</mat-label>
          <mat-select [(ngModel)]="f.banosMax" name="banosMax">
            <mat-option value="">Cualquiera</mat-option>
            <mat-option *ngFor="let b of banos" [value]="b">{{ b }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- üîπ Metros Cuadrados -->
      <div>
        <h3>Metros</h3>
        <mat-form-field class="field">
          <mat-label>M√≠n</mat-label>
          <input
            matInput
            type="number"
            [(ngModel)]="f.metrosMin"
            name="metrosMin"
            placeholder="M√≠nimo"
          />
        </mat-form-field>
        <mat-form-field class="field">
          <mat-label>M√°x</mat-label>
          <input
            matInput
            type="number"
            [(ngModel)]="f.metrosMax"
            name="metrosMax"
            placeholder="M√°ximo"
          />
        </mat-form-field>
      </div>
    </div>

    <!-- üîπ Estado -->
    <div class="estado-filter" [class.active]="showMoreFilters">
      <h3>Estado</h3>
      <mat-form-field>
        <mat-label>Estado</mat-label>
        <mat-select [(ngModel)]="f.estado" name="estado">
          <mat-option value="">Cualquiera</mat-option>
          <mat-option value="obra nueva">Obra nueva</mat-option>
          <mat-option value="en buen estado">En buen estado</mat-option>
          <mat-option value="a reformar">A reformar</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </form>
</section>

<div class="grid">
  <mat-card *ngFor="let i of inmuebles" class="card">
    <a [routerLink]="['/inmueble', i.id]">
      <img
        mat-card-image
        [src]="
          i.fotoPrincipal
            ? 'https://tomasapi.es' + i.fotoPrincipal
            : 'https://picsum.photos/seed/fallback/800/450'
        "
        alt="foto"
      />
    </a>
    <mat-card-content>
      <h3>{{ i.titulo }}</h3>
      <p class="subtitle">{{ i.tipo | replaceUnderscore | titlecase }} ¬∑ {{ i.zona }}</p>
      <p class="subtitle">
        üõè {{ i.dormitorios }} ¬∑ üõÅ {{ i.banos || 0 }} ¬∑ üìê {{ i.metrosUtiles || 0 }} m¬≤
      </p>
      <p class="precio">{{ i.precio | currency : 'EUR' : 'symbol' : '1.0-0' }}</p>
    </mat-card-content>
    <mat-card-actions class="card-footer">
      <a mat-button color="primary" [routerLink]="['/inmueble', i.id]">Ver detalles</a>
      <a mat-stroked-button color="primary" [href]="i.urlIdealista" target="_blank" rel="noopener"
        >Idealista</a
      >
    </mat-card-actions>
  </mat-card>
</div>

<div *ngIf="inmuebles.length === 0" class="no-results">
  <p>No hay propiedades que coincidan con tu b√∫squeda üè†</p>
</div>

<app-contact-bar></app-contact-bar>
<a
  href="https://wa.me/34670950002"
  target="_blank"
  rel="noopener"
  class="whatsapp-float"
  aria-label="Contactar por WhatsApp"
>
  <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp" />
</a>
<app-footer></app-footer>
